C51 COMPILER V9.01   MAIN                                                                  08/26/2021 18:42:59 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\8051\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          /***************************Infrared.c ÎÄ¼þ³ÌÐòÔ´´úÂë*****************************/
   2          #include <reg52.h>
   3          #include <intrins.h>
   4          sbit IR_IN =P3^2;    //ºìÍâ½ÓÊÕÒý½Å
   5          sbit SB_OUT =P1^1;       //Ê§°ÜÐÅºÅÊä³ö
   6          sbit FH_IN  =P1^2;       //¸´»îÔÊÐíÐÅºÅÊäÈë
   7          
   8          unsigned char ircode[4]; //ºìÍâ´úÂë½ÓÊÕ»º³åÇø
   9          bit flag_Ir=0; //ºìÍâ½ÓÊÕ±êÖ¾£¬ÊÕµ½Ò»Ö¡ÕýÈ·Êý¾ÝºóÖÃ 1
  10          
  11          unsigned int err;     //Õâ4¸ö±äÁ¿ÓÉReadIr()º¯Êýµ÷ÓÃ
  12          unsigned int tt;      //
  13          unsigned char Time;   //
  14          unsigned char j, k;   //
  15          unsigned int q;           //Ñ­»·¿ØÖÆ±äÁ¿        
  16          
  17          unsigned int sm;          //ÉúÃü¼ÆÊýÆ÷
  18          unsigned int sb;          //Ê§°ÜÖ¸Ê¾Î»
  19           
  20          void Ir_Init();       //ºìÍâ³õÊ¼»¯£¨Íâ²¿ÖÐ¶Ï0ºÍ·¢ËÍ½ÓÊÕ¶Ë¿Ú³õÊ¼»¯£©
  21          //void FH_INT();        //¸´»î×¨ÓÃº¯Êý
  22          void Delay7us();        //7usÑÓÊ± @24.000MHz
  23          void Delay19us();      //19usÑÓÊ±@24.000MHz
  24          void Delay100us();    //100usÑÓÊ±@24.000MHz
  25          void fengming();//·äÃùÆ÷Çý¶¯º¯Êý
  26          
  27          /*Ö÷º¯Êý*/
  28          void main()
  29          {
  30   1              sm=0;
  31   1              SB_OUT=1;
  32   1              Ir_Init();                   //ºìÍâ³õÊ¼»¯
  33   1          while (1)
  34   1          {   
  35   2                      if(flag_Ir)                //Èç¹û½ÓÊÕµ½ÍêÕûÊý¾Ý£¬ÔòÖ´ÐÐÅÐ¶¨³ÌÐò¡£
  36   2              {
  37   3                              flag_Ir=0;//±ØÐëÇå¿Õ½ÓÊÕÍê³É±êÖ¾
  38   3                              fengming();     
  39   3              }
  40   2          }
  41   1      }
  42          
  43          
  44          /*¸´»î×¨ÓÃº¯Êý*/
  45          /*void FH_INT()
  46          {
  47                  if(FH_IN==0)
  48                  {
  49                          sm=3;
  50                          SB_OUT=0;
  51                  }
  52                  else
  53                  {
  54                          sm=0;
  55                  }
C51 COMPILER V9.01   MAIN                                                                  08/26/2021 18:42:59 PAGE 2   

  56                  
  57          } */
  58          
  59          /* ºìÍâ½ÓÊÕ³õÊ¼»¯*/
  60          void Ir_Init(void)
  61          {
  62   1        IT0= 1;//ÏÂ½µÑØ´¥·¢
  63   1        EX0= 1;    //´ò¿ªÖÐ¶Ï0ÔÊÐí
  64   1        EA= 1;    //´ò¿ª×ÜÖÐ¶Ï
  65   1        IR_IN  = 1;    //³õÊ¼»¯¶Ë¿Ú
  66   1        flag_Ir= 0;    //³õÊ¼»¯½ÓÊÕÍê³É±êÖ¾Î»
  67   1      }
  68          
  69          /*¶ÁÈ¡ºì·¢ÍâÖµÍâ²¿ÖÐ¶ÏµÄ·þÎñ³ÌÐò*/
  70          void ReadIr() interrupt 0
  71          {
  72   1          
  73   1          EA=0;                                                            //¹Ø±Õ×ÜÖÐ¶Ï
  74   1        Time=0;
  75   1        tt=80;                                                      //ÑÓÊ±8msÈ¥¸ÉÈÅ£¬Òýµ¼ÂëÎª9msµÄµÍµçÆ½ºÍ4.5msµ
             -Ä¸ßµçÆ½
  76   1          do 
  77   1              {
  78   2                      Delay100us(); 
  79   2              } 
  80   1              while(--tt);
  81   1                      if(IR_IN==0)                                                //È·ÈÏÊÇ·ñÕæµÄ½ÓÊÕµ½ÕýÈ·µÄÐÅºÅ
  82   1                      {
  83   2                              err=500;                                                //³¬Ê±ÅÐ¶Ï
  84   2                              while((IR_IN==0)&&(err>0))                //µÈ´ý¸ßµçÆ½£¬×î¶àµÈ´ý50ms
  85   2                                      {
  86   3                                              Delay100us();
  87   3                                              err--;
  88   3                                      }
  89   2                              if(IR_IN==1)                                            //ÊÕµ½¸ßµçÆ½
  90   2                              {
  91   3                                      err=500;                                            //³¬ÊÐÅÐ¶Ï
  92   3                                      while((IR_IN==1)&&(err>0))            //µÈ´ý4.5msµÄ¸ßµçÆ½¹ýÈ¥
  93   3                                      {
  94   4                                              Delay100us();
  95   4                                              err--;
  96   4                                      }
  97   3                              for(k=0; k<4; k++)                        //¿ªÊ¼½ÓÊÕÊý¾Ý£¬¹²ÓÐ4¸öÊý¾Ý
  98   3                              {
  99   4                                      for(j=0; j<8; j++)                    //Ã¿¸ö8Î»
 100   4                                      {
 101   5                                              err=60;
 102   5                                              while((IR_IN==0)&&(err>0))    //µÈ´ýÐÅºÅÇ°ÃæµÄ560usµÍµçÆ½¹ýÈ¥
 103   5                                              {
 104   6                                                      Delay100us();
 105   6                                                      err--;
 106   6                                              }
 107   5                                                      err=500;
 108   5                                              while((IR_IN==1)&&(err>0))    //¼ÆËã¸ßµçÆ½µÄÊ±¼ä³¤¶È¡£
 109   5                                              {
 110   6                                                      Delay100us();
 111   6                                                      Time++;
 112   6                                                      err--;
 113   6                                              if(Time>50)                            //³¬¹ý5msËµÃ÷½ÓÊÕµ½ÖØ¸´Âë¡£ÖØ¸´Âë£º9ms¸ßµçÆ½+2.25msµÍµçÆ½+560u
             -s¸ßµçÆ½
 114   6                              {
 115   7                                  EA=1;                                    //´ò¿ª×ÜÖÐ¶Ï
C51 COMPILER V9.01   MAIN                                                                  08/26/2021 18:42:59 PAGE 3   

 116   7                    return;                                //ÍË³öº¯Êý
 117   7                              }
 118   6                }
 119   5                ircode[k]>>=1;                         //k±íÊ¾µÚ¼¸×éÊý¾Ý
 120   5                if(Time>=8)                                //Èô¸ßµçÆ½³öÏÖ´óÓÚ0.8ms£¬Îª1£¨1.65msÎª1£¬0.56msÎª0£¬Õ
             -âÀïÈ¡ÖÐ¼äÖµ£©
 121   5                  ircode[k]|=0x80;
 122   5                Time=0;                                        //ÓÃÍêÊ±¼äÒªÖØÐÂ¸³Öµ
 123   5              }
 124   4            }
 125   3          }
 126   2          if(ircode[0]=~ircode[1])            //ÕâÀïÅÐ¶ÏµØÖ·ÂëºÍµØÖ··´Âë¶Ô·ñÏàÍ¬¡£
 127   2          {
 128   3              if(ircode[2]=~ircode[3])            //ÕâÀïÅÐ¶Ï×Óµ¯ÂëÊÇ·ñºÏ·¨¡£
 129   3                      {
 130   4                              if(ircode[0]==0x0A)                             //ÈôÏàÍ¬ÔòÅÐ¶ÏµØÖ·ÂëÊÇ·ñÕýÈ·¡£
 131   4                              {
 132   5                                      flag_Ir = 1;                            //ÈôµØÖ·ÂëÕýÈ·£¬Ôò½ÓÊÕÍê³É±êÖ¾ÖÃÎ»¡£    
 133   5                              }
 134   4                              else
 135   4                              {
 136   5                              flag_Ir = 0;                            //ÈôµØÖ·Âë´íÎó£¬Ôò²»ÖÃÎ»Íê³É±êÖ¾Î»£¬ÒÔ×èÖ¹´íÎó·ÃÎÊ¡£    
 137   5                              } 
 138   4                      }
 139   3                      else
 140   3                      {
 141   4                              flag_Ir = 0;                            //Èô×Óµ¯Âë²»ºÏ·¨£¬ÔòÍ¬Ñù²»ÖÃÎ»Íê³É±êÖ¾Î»£¬ÒÔ×èÖ¹¡°×ß»ð¡±¡£      
 142   4                      }
 143   3                                                     
 144   3          }
 145   2        }
 146   1          EA=1;                                                            //´ò¿ª×ÜÖÐ¶Ï
 147   1      }
 148          
 149          /* ÑÓÊ±7us£¬Éú³É38k²¨Ê¹ÓÃ*/
 150          void Delay7us()        //@24.000MHz
 151          {
 152   1              unsigned char a,b,c,d;
 153   1              for(d=1;d>0;d--)
 154   1                      for(c=1;c>0;c--)
 155   1                  for(b=1;b>0;b--)
 156   1                      for(a=1;a>0;a--);
 157   1      }
 158          /**************************************************************************************************
 159          * ÑÓÊ±19us @ 24MHz STC-Y5
 160          * Éú³É38k²¨Ê¹ÓÃ£¬Õ¼¿Õ±ÈÔÚ1/3Ê±Ð§¹û×îºÃ¡£iµÄÈ¡Öµ¹©²Î¿¼£¬Ê¹ÓÃÊ±ÊÓ²¨ÐÎ±íÏÖµ÷Õû¡£
 161          */
 162          void Delay19us()        //@24.000MHz
 163          {
 164   1              unsigned char a,b;
 165   1                      for(b=7;b>0;b--)
 166   1                              for(a=1;a>0;a--);
 167   1      }
 168          /**************************************************************************************************
 169          * ÑÓÊ±100us @ 24MHz STC-Y5
 170          */
 171          void Delay100us()        //@24.000MHz
 172          {
 173   1              unsigned char a,b;
 174   1              for(b=1;b>0;b--)
 175   1                      for(a=97;a>0;a--);
 176   1      }
C51 COMPILER V9.01   MAIN                                                                  08/26/2021 18:42:59 PAGE 4   

 177          
 178          /*·äÃùÆ÷Çý¶¯³ÌÐò*/
 179          void fengming()    //·äÃùº¯Êý£¬Âö¿ít = 1ms ÖÜÆÚT = 2ms ÆµÂÊf = 0.5khz Êµ¼Ê·¢ÏÖÑÓÊ±1msµÄÊ±ºòÐ§¹û×îºÃ
 180          {
 181   1              while(1)
 182   1                      {
 183   2                              SB_OUT=0;   //¸øP1.5¿ÚËÍµÍµçÆ½
 184   2                      }
 185   1                      
 186   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    398    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     17    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =      1    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
